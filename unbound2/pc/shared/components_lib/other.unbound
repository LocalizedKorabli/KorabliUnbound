(def constant SETTINGS_BUTTON_PORT_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DOWN		: 0.5,
	SC.Ui_styles.BUTTON_STATE.OVER		: "TA",
	SC.Ui_styles.BUTTON_STATE.UP		: 0.65
})


(def element ButtonCameraExcursion (_isInOverState:bool=false, _isInDownState:bool=false, _isExcursionOn:bool=false, _enabled:bool=true)
	(scope
		(event evOnButtonClicked)
		(event btnExcursion_evMouseUp)

		(macro MOUSE_HANDLER_SCOPE "'btnExcursion_'")

		(var isInOverState:bool = "_isInOverState || btnExcursion_rollOver && !btnExcursion_mouseDown")
		(var isInDownState:bool = "_isInDownState || btnExcursion_rollOver && btnExcursion_mouseDown")

		(var backgroundImageURL:str = "_isExcursionOn	? 'url:../service_kit/buttons/icon_controls/camera_on.png'
														: 'url:../service_kit/buttons/icon_controls/camera_off.png'")
	)

	(macro MOUSE_HANDLER
		_enabled = "_enabled"
		_prefix = "'btnExcursion_'"
		_soundSet = "'button_secondary'"
	)
	(dispatch btnExcursion_evMouseUp on='mouseUp' args="{isDown: false}" (bind enabled "_enabled"))
	(dispatch evOnButtonClicked args={} dir="EventDirection.UP" (event "btnExcursion_evMouseUp"))

	(style
		(backgroundSize = "autosize")
		(bind backgroundImage "backgroundImageURL")
	)
)

(def element ButtonSettingsSmall (_enabled:bool=true)
	(scope
		(event evOnButtonClicked)
		(event btn_evMouseUp)

		(macro MOUSE_HANDLER_SCOPE "'btn_'")

		(var isInOverState:bool = "btn_rollOver && !btn_mouseDown")
		(var isInDownState:bool = "btn_mouseDown")
	)

	(macro MOUSE_HANDLER
		_enabled = "_enabled"
		_prefix = "'btn_'"
		_soundSet = "'default_button'"
	)
	(dispatch btn_evMouseUp on='mouseUp' args="{isDown: false}" (bind enabled "_enabled"))
	(dispatch evOnButtonClicked args={} dir="EventDirection.UP" (event "btn_evMouseUp"))

	(style
		(width = 24px)
		(height = 23px)
		(backgroundImage = "'url:../service_kit/buttons/button_settings_small.png'")
	)

	(block
		(alpha = "isInOverState ? 1 : 0")
		(controller $Animation
			(bindcall play	duration=0.15	to="{alpha: 1, visible: true}"	(bind enabled "isInOverState"))
			(bindcall play	duration=0.15	to="{alpha: 0, visible: false}"	(bind enabled "!isInOverState"))
		)

		(style
			(hitTest = "false")
			(position = "absolute")
			(width = 100%)
			(height = 100%)
			(backgroundImage = "'url:../service_kit/buttons/button_settings_small_over.png'")
		)
	)

	(block
		(bind alpha "isInDownState ? 1 : 0")
		(style
			(hitTest = "false")
			(position = "absolute")
			(width = 100%)
			(height = 100%)
			(backgroundImage = "'url:../service_kit/buttons/button_settings_small_down.png'")
		)
	)
)

(def element SettingsButtonPort (_withBg:bool=true)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var accountLevelEntity:dhEntity = "getSingleEntity(CC.accountLevel)")
		(var accountLevelComponent:dhComponent = "accountLevelEntity.accountLevel")
		(var curAccountLevel:number = "accountLevelComponent.level ?: 0" (event "accountLevelComponent.evLevelChanged"))

		(var userTaskEntity:dhEntity = "getSingleEntity(CC.userTask)")
		(var userTaskComponent:dhComponent = "userTaskEntity.userTask")
		(var currentUserTaskFlags:array = "userTaskComponent.flags ?: []" (event "userTaskComponent.evFlagChanged"))
		(var userDoNotWatchTutorial:bool = "currentUserTaskFlags[BINARY_SHIFT_MAP[SC.Common.USER_TASKS_FLAGS.KNOWS_ABOUT_TUTORIAL]] == 0")
		(var showTutorial:bool = "userDoNotWatchTutorial && curAccountLevel > 4")

		(var state:number = "	rollOver && !mouseDown	? SC.Ui_styles.BUTTON_STATE.OVER :
								mouseDown				? SC.Ui_styles.BUTTON_STATE.DOWN
														: SC.Ui_styles.BUTTON_STATE.UP")
		(var btnAlpha:number = "SETTINGS_BUTTON_PORT_ALPHA[state]")
	)
	(name = 'ButtonSettings')

	(macro MOUSE_HANDLER
		_soundSet = "'button_settings'"
		_methods = "[{ type: 'inputMapping.onAction', name: 'openLobbyMenu', args: {} }]"
	)

	(style
		(align = "center|middle")
		(width = 48px)
		(height = 60px)
	)

	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='DockHeaderControlBackground'
			(bind enabled "_withBg")
			(args
				_state = "state"
			)
		)
	)


	(block
		(style
			(hitTest = false)
			(width = 32px)
			(height = 32px)
			(backgroundImage = 'url:../service_kit/buttons/settings/big.png')
			(bind alpha "btnAlpha" watch=false)
		)

		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger	= "state"
			_alpha		= "btnAlpha"
		)
	)

	(block
		(macro DEFAULT_CONTROL_MARKER_ANIMATION "showTutorial")
		(style
			(position = "absolute")
			(right = -10px)
			(top = "S")
			(hitTest = false)
		)

		(element MarkerNew)
	)

	(controller $Tooltip
		(renderer = 'SimpleStatusTooltip')
		(args
			_text = 'IDS_TOOLTIP_MENU'
			_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.MOUSE_LEFT"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR "0")
	)
)